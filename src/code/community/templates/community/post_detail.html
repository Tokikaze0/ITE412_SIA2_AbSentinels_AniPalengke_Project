{% extends 'core/base.html' %}

{% block title %}{{ post.title }} Â· AniPalengke{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; padding-top: 2rem;">
    <a href="{% url 'community_feed' %}" class="btn btn-ghost" style="margin-bottom: 1rem; display: inline-flex; align-items: center; gap: 0.5rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        Back to Community
    </a>

    <!-- Post Content -->
    <div class="card" style="margin-bottom: 2rem;">
        <div class="card-body" style="padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                <div>
                    <div style="display: flex; gap: 0.75rem; align-items: center; margin-bottom: 0.75rem;">
                        <span class="badge badge-{{ post.post_type }}" style="padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.875rem; font-weight: 600;">{{ post.post_type|title }}</span>
                        <span class="muted" style="font-size: 0.875rem;">{{ post.created_at|date:"M d, Y" }}</span>
                    </div>
                    <h1 style="margin: 0; font-size: 2rem; line-height: 1.2; color: var(--gray-900);">{{ post.title }}</h1>
                </div>
            </div>
            
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--gray-200);">
                <div style="width: 40px; height: 40px; background: var(--green-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--green-700); font-weight: 700;">
                    {{ post.author_name|slice:":1"|upper }}
                </div>
                <div>
                    <div style="font-weight: 600; color: var(--gray-900);">{{ post.author_name }}</div>
                    <div class="muted" style="font-size: 0.875rem;">Author</div>
                </div>
            </div>

            {% if post.image_url %}
                <div style="margin-bottom: 2rem;">
                    <img src="{{ post.image_url }}" alt="Post Image" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                </div>
            {% endif %}

            <div style="font-size: 1.125rem; line-height: 1.7; color: var(--gray-700);">
                {{ post.content|linebreaks }}
            </div>
        </div>
    </div>

    <!-- Comments Section -->
    <div style="margin-bottom: 3rem;">
        <h3 style="font-size: 1.5rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
            Comments 
            <span style="background: var(--gray-200); color: var(--gray-700); padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 1rem;">{{ post.comments|length }}</span>
        </h3>

        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for comment in post.comments %}
            <div class="card" style="border: 1px solid var(--gray-200); box-shadow: none;">
                <div class="card-body" style="padding: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 32px; height: 32px; background: var(--gray-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--gray-700); font-weight: 600; font-size: 0.875rem;">
                                {{ comment.author_name|slice:":1"|upper }}
                            </div>
                            <span style="font-weight: 600; color: var(--gray-900);">{{ comment.author_name }}</span>
                        </div>
                        <small class="muted">{{ comment.created_at|timesince }} ago</small>
                    </div>
                    <div style="color: var(--gray-700); line-height: 1.5; padding-left: 3rem;">
                        {{ comment.content|linebreaks }}
                    </div>
                </div>
            </div>
            {% empty %}
            <div style="text-align: center; padding: 3rem; background: var(--white); border-radius: var(--radius); border: 1px dashed var(--gray-200);">
                <div style="color: var(--gray-400); margin-bottom: 0.5rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                </div>
                <p class="muted">No comments yet. Be the first to share your thoughts!</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Add Comment Form -->
    <div class="card" style="background: var(--cream-50); border: 1px solid var(--green-600);">
        <div class="card-body" style="padding: 2rem;">
            <h4 style="margin-top: 0; margin-bottom: 1rem; color: var(--green-700);">Join the Discussion</h4>
            <form action="{% url 'add_comment' post.id %}" method="post">
                {% csrf_token %}
                <div class="form-group" style="margin-bottom: 1rem;">
                    <textarea name="content" class="input" rows="4" placeholder="What are your thoughts on this?" required style="width: 100%; padding: 1rem; border: 1px solid var(--green-600); border-radius: var(--radius-sm); resize: vertical; font-family: inherit;"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end;">
                    <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.5rem; font-weight: 600;">Post Comment</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}