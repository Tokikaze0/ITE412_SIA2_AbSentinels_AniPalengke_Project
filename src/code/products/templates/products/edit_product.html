{% extends 'core/base.html' %}

{% block title %}Edit Product Â· AniPalengke{% endblock %}

{% block content %}
<div class="container" style="max-width: 700px;">
    <div class="section-header">
        <h2>Edit Product</h2>
        <p class="muted">Update your product details.</p>
    </div>

    <div class="card">
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" class="form">
                {% csrf_token %}
                
                <!-- Image Upload Section -->
                <div class="form-group">
                    <label class="label">Product Image</label>
                    <label class="upload-area" id="drop-zone">
                        <input type="file" id="image" name="image" accept="image/*" style="display: none;" onchange="previewImage(this)">
                        <div id="upload-placeholder" {% if product.image %}style="display: none;"{% endif %}>
                            <div style="font-size: 2.5rem; margin-bottom: 10px;">ðŸ“¸</div>
                            <span style="color: var(--green-600); font-weight: 600;">Click to Change Photo</span>
                            <p class="muted" style="font-size: 0.9rem; margin-top: 5px;">Supported formats: JPG, PNG</p>
                        </div>
                        <img id="image-preview" src="{{ product.image|default:'#' }}" alt="Preview" style="{% if not product.image %}display: none;{% endif %} max-height: 300px; width: 100%; object-fit: contain; border-radius: 8px;">
                    </label>
                </div>

                <div class="form-group">
                    <label for="name" class="label">Product Name</label>
                    <input type="text" id="name" name="name" class="input" value="{{ product.name }}" required>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="price" class="label">Price (â‚± per kg/pc)</label>
                        <input type="number" id="price" name="price" class="input" step="0.01" value="{{ product.price }}" required>
                    </div>
                    <div class="form-group">
                        <label for="stock" class="label">Available Stock</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="stock" name="stock" class="input" value="{{ product.stock }}" required>
                            <span class="muted" style="font-size: 0.9rem; white-space: nowrap;">kg / pcs</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="category" class="label">Category</label>
                        <select id="category" name="category" class="select" required>
                            <option value="" disabled>Select Category</option>
                            <option value="Gulay" {% if product.category == 'Gulay' %}selected{% endif %}>Gulay (Vegetables)</option>
                            <option value="Prutas" {% if product.category == 'Prutas' %}selected{% endif %}>Prutas (Fruits)</option>
                            <option value="Root Crops" {% if product.category == 'Root Crops' %}selected{% endif %}>Root Crops</option>
                            <option value="Other" {% if product.category == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="location" class="label">Farm Location</label>
                        <input type="text" id="location" name="location" class="input" value="{{ product.location }}" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description" class="label">Description</label>
                    <textarea id="description" name="description" class="textarea" rows="4">{{ product.description }}</textarea>
                </div>

                <div class="spacer"></div>

                <div class="grid grid-2">
                    <a href="{% url 'product_list' %}" class="btn btn-secondary" style="text-align: center;">Cancel</a>
                    <button type="submit" class="btn btn-primary">Update Product</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function previewImage(input) {
        const preview = document.getElementById('image-preview');
        const placeholder = document.getElementById('upload-placeholder');
        
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}
