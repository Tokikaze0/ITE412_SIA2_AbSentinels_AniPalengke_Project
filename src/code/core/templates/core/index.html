{% extends 'core/base.html' %}
{% load static %}

{% block title %}AniPalengke ‚Äì Farmer-to-Buyer Marketplace{% endblock %}

{% block content %}
<div class="container">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="grid grid-2" style="align-items: center;">
      <div class="hero-content">
        <h1>Fresh from the Farm, Straight to Your Table</h1>
        <p>AniPalengke connects local farmers directly with buyers. Enjoy fresh produce, fair prices, and smart agricultural advice.</p>
        <div class="cta">
          {% if not user.is_authenticated %}
          <a class="spaces">„Ö§<a/a>
          <a class="btn btn-primary" href="{% url 'register' %}">Join Now</a>
          <a class="spaces">„Ö§<a/a>
          <a class="btn btn-secondary" href="{% url 'login' %}">Login</a>
          {% else %}
          <a class="btn btn-primary" href="{% url 'product_list' %}">Start Shopping</a>
          {% endif %}
        </div>
      </div>
      <div style="text-align: center;">
        <!-- Hero Image -->
        <img src="{% static 'images/logo.png' %}" alt="AniPalengke Logo" style="max-width: 350px; width: 100%; height: auto; border-radius: 24px; box-shadow: var(--shadow-md);">
      </div>
    </div>
  </section>

  <!-- Flash Sales Section -->
  {% if flash_sale_products %}
  <section class="section" style="background: #fff0f0; padding: 30px; border-radius: 12px; border: 1px solid #ffcccc;">
    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="display: flex; align-items: center; gap: 10px;">
          <h2 style="color: #d32f2f; margin: 0;">‚ö° Flash Sales</h2>
          <span style="background: #d32f2f; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">Ending Soon</span>
      </div>
      <div id="countdown" style="font-family: monospace; font-size: 1.2rem; font-weight: bold; color: #d32f2f;">00:00:00</div>
    </div>
    <div class="grid grid-4">
      {% for product in flash_sale_products %}
      <article class="product-card">
        <a href="{% url 'product_detail' product.id %}" style="text-decoration: none; color: inherit;">
            <div class="card-media">
                {% if product.discount_percent %}
                <div style="position: absolute; top: 10px; left: 10px; background: #d32f2f; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem;">-{{ product.discount_percent }}%</div>
                {% endif %}
                {% if product.image %}
                <img src="{{ product.image }}" alt="{{ product.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                <div style="width: 100%; height: 100%; background: #eee; display: flex; align-items: center; justify-content: center;">{{ product.name|slice:":1" }}</div>
                {% endif %}
            </div>
            <div class="card-content">
            <div class="card-title">{{ product.name }}</div>
            <div class="card-meta">
                <span style="color: #d32f2f; font-weight: bold;">‚Ç±{{ product.discount_price|default:product.price }}</span>
                {% if product.discount_price and product.discount_price < product.price %}
                <span style="text-decoration: line-through; color: #999; font-size: 0.9rem;">‚Ç±{{ product.price }}</span>
                {% endif %}
            </div>
            <div class="muted" style="font-size: 0.8rem; margin-top: 5px;">üî• {{ product.sold_percentage|default:"50" }}% Sold</div>
            <div style="width: 100%; height: 6px; background: #eee; border-radius: 3px; margin-top: 5px; overflow: hidden;">
                <div style="width: {{ product.sold_percentage|default:'50' }}%; height: 100%; background: #d32f2f;"></div>
            </div>
            </div>
        </a>
      </article>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <script>
    // Simple Countdown Timer
    function startTimer(duration, display) {
        var timer = duration, hours, minutes, seconds;
        setInterval(function () {
            hours = parseInt(timer / 3600, 10);
            minutes = parseInt((timer % 3600) / 60, 10);
            seconds = parseInt(timer % 60, 10);

            hours = hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = hours + ":" + minutes + ":" + seconds;

            if (--timer < 0) {
                timer = duration;
            }
        }, 1000);
    }

    window.onload = function () {
        var threeHours = 60 * 60 * 3; // 3 hours in seconds
        var display = document.querySelector('#countdown');
        if (display) {
            startTimer(threeHours, display);
        }
    };
  </script>

  <!-- Value Proposition -->
  <section class="section">
    <div class="section-header">
      <h2>Why Choose AniPalengke?</h2>
      <p class="muted">Empowering farmers, satisfying buyers.</p>
    </div>
    <div class="grid grid-3">
      <div class="feature-card">
        <div class="feature-icon">ü•¨</div>
        <h3>Fresh & Local</h3>
        <p class="muted">Get produce harvested directly from local farms. No middlemen, just freshness.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">ü§ù</div>
        <h3>Fair Trade</h3>
        <p class="muted">Farmers get better prices, and buyers get better value. It's a win-win.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üß†</div>
        <h3>Smart Advisory</h3>
        <p class="muted">Access community-driven agricultural advice and farming tips.</p>
      </div>
    </div>
  </section>

  <!-- Featured Products -->
  {% if featured_products %}
  <section class="section">
    <div class="section-header">
      <h2>Featured Products</h2>
      <a href="{% url 'product_list' %}" style="color: var(--green-600); text-decoration: none;">View All &rarr;</a>
    </div>
    <div class="grid grid-4">
      {% for product in featured_products %}
      <article class="product-card">
        <div class="card-media">
            {% if product.image %}
            <img src="{{ product.image }}" alt="{{ product.name }}" style="width:100%;height:100%;object-fit:cover;"/>
            {% else %}
            No Image
            {% endif %}
        </div>
        <div class="card-content">
          <div class="card-title">{{ product.name }}</div>
          <div class="card-meta">
            <span>‚Ç±{{ product.price }}/kg</span>
            <span>{{ product.location }}</span>
          </div>
        </div>
      </article>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- Join Us Section -->
  <section class="section" style="margin-top: 60px; margin-bottom: 60px;">
    <div class="section-header">
      <h2>Join Our Community</h2>
      <p class="muted">Choose how you want to participate in the marketplace.</p>
    </div>
    <div class="grid grid-2" style="max-width: 800px; margin: 0 auto;">
      <a href="{% url 'register' %}" class="role-card">
        <div style="font-size: 3rem; margin-bottom: 10px;">üë®‚Äçüåæ</div>
        <h3>Become a Farmer</h3>
        <p class="muted">List your crops, manage inventory, and reach more buyers.</p>
      </a>
      <a href="{% url 'register' %}" class="role-card">
        <div style="font-size: 3rem; margin-bottom: 10px;">üõí</div>
        <h3>Become a Buyer</h3>
        <p class="muted">Shop for fresh ingredients and support local agriculture.</p>
      </a>
    </div>
  </section>
</div>
{% endblock %}
